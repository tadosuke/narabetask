# ナラベタスク (NarabeTask)

効率的なタスク実行順序を調整する Web アプリケーションです。作業時間と待ち時間を個別に設定し、タスクの重複を視覚的に管理できます。

## 機能概要

### 基本機能

- **タスク管理**: タスクの作成、編集、削除
- **作業時間・待ち時間設定**: 各タスクの作業時間と待ち時間を個別に設定可能（15 分刻み）
- **タイムライン配置**: ドラッグ&ドロップでタスクをタイムラインに配置
- **営業時間対応**: 営業時間（09:00-18:00）内でのスケジューリング
- **タスクロック機能**: 配置されたタスクをロックして位置を固定
- **重複検知**: タスクの作業時間重複を自動検知・視覚的表示

### 高度な機能

- **最適化アルゴリズム**: 待ち時間を活用した効率的なタスク配置の自動最適化
- **ドラッグ&ドロップ**: 直感的なタスク移動とタイムライン配置
- **レスポンシブデザイン**: モバイル、タブレット、デスクトップに対応
- **永続化**: ローカルストレージによるタスクデータの保存

## 技術スタック

- **フロントエンド**: React 19.1.0 + TypeScript 5.8.3
- **ビルドツール**: Vite 7.0.4
- **スタイリング**: CSS Modules（個別 CSS ファイル）
- **テスト**: Vitest 3.2.4 + Testing Library
- **リンター**: ESLint 9.30.1 + TypeScript ESLint 8.35.1
- **DOM 環境**: jsdom 26.1.0（テスト用）

### 主要依存関係

- `react` / `react-dom`: UI ライブラリ
- `@vitejs/plugin-react`: Vite React プラグイン
- `@testing-library/react` / `@testing-library/jest-dom`: テストライブラリ
- `vitest`: 高速テストランナー

## 開発環境セットアップ

### 前提条件

- Node.js 18 以上
- npm または yarn

### インストールと起動

```bash
# 依存関係をインストール
npm install

# 開発サーバーを起動（http://localhost:5173）
npm run dev

# 本番用ビルド
npm run build

# ビルド結果をプレビュー
npm run preview

# 全テスト実行
npm run test

# テストUIでブラウザ実行
npm run test:ui

# ESLintでコードチェック
npm run lint
```

## コーディング規約

このプロジェクトでは [GitHub Copilot カスタム指示](./.copilot-instructions.md) に従って開発を行っています。

### 主な規約

- **日本語対応**: UI テキスト、コメント、テストの説明は日本語を使用
- **単一責任の原則**: 各コンポーネント・関数は明確な単一の責務を持つ
- **レスポンシブデザイン**: モバイルファーストで全デバイスに対応
- **TypeScript**: 厳格な型定義でコードの安全性を確保

詳細は [.copilot-instructions.md](./.copilot-instructions.md) をご覧ください。

## プロジェクト構成

```
src/
├── components/           # React コンポーネント
│   ├── TaskCard/         # タスクカードコンポーネント
│   │   ├── TaskCard.tsx      # メインタスクカード
│   │   ├── TaskHeader.tsx    # タスクヘッダー（名前表示）
│   │   └── TaskFooter.tsx    # タスクフッター（ロックボタン）
│   ├── TaskSidebar/      # タスク詳細サイドバー
│   │   ├── TaskSidebar.tsx       # メインサイドバー
│   │   ├── TaskNameField.tsx     # タスク名入力フィールド
│   │   ├── TaskWorkTimeSlider.tsx # 作業時間スライダー
│   │   ├── TaskWaitTimeSlider.tsx # 待ち時間スライダー
│   │   ├── TaskTotalTimeDisplay.tsx # 合計時間表示
│   │   ├── TaskInfoDisplay.tsx   # タスク情報表示
│   │   └── TaskActions.tsx       # タスク操作ボタン
│   ├── TaskStaging/      # タスクステージングエリア
│   │   ├── TaskStaging.tsx           # メインステージング
│   │   ├── TaskStagingHeader.tsx     # ヘッダー（タイトル・追加ボタン）
│   │   ├── TaskStagingContents.tsx   # コンテンツ（タスク一覧）
│   │   └── TaskStagingInstructions.tsx # 使い方説明
│   └── Timeline/         # タイムラインコンポーネント
│       ├── Timeline.tsx      # メインタイムライン
│       └── TimeSlot.tsx      # 個別タイムスロット
├── contexts/            # React Context
│   ├── TaskContext.tsx           # タスク管理コンテキスト
│   ├── TaskSidebarContext.tsx    # サイドバーコンテキスト
│   ├── TaskStagingContext.tsx    # ステージングコンテキスト
│   └── useTaskContext.ts         # カスタムフック
├── utils/              # ユーティリティ関数
│   ├── taskOptimization.ts  # タスク最適化アルゴリズム
│   ├── timeUtils.ts         # 時間計算ユーティリティ
│   ├── storage.ts           # ローカルストレージ管理
│   └── idGenerator.ts       # ID生成ユーティリティ
├── types.ts            # TypeScript型定義
└── App.tsx             # メインアプリケーション
```

## 主要機能の詳細

### タスク管理

- **作業時間**: 実際の作業にかかる時間（15 分〜4 時間、15 分刻み）
- **待ち時間**: 他の処理待ちなどの時間（0 分〜4 時間、15 分刻み）
- **合計時間**: 作業時間 + 待ち時間の自動計算表示
- **ロック機能**: 配置されたタスクの位置を固定

### タイムライン

- **営業時間**: 09:00-18:00 の時間枠で 15 分刻みのスロット表示
- **ドラッグ&ドロップ**: タスクをステージングエリアからタイムラインに配置
- **重複検知**: 作業時間が重複するタスクを赤色で警告表示
- **最適化ボタン**: 自動でタスクの最適配置を実行

### 最適化アルゴリズム

1. **固定タスク保持**: ロックされたタスクは位置を固定
2. **待ち時間活用**: あるタスクの待ち時間に他のタスクの作業時間を配置
3. **重複回避**: 作業時間同士の重複を防止
4. **最早終了**: 全体の終了時間を最小化

## 使い方

### 基本的な操作手順

1. **タスク作成**: 「+ 新しいタスク」ボタンでタスクを作成
2. **時間設定**: サイドバーで作業時間・待ち時間を調整
3. **タイムライン配置**: タスクをドラッグしてタイムラインに配置
4. **最適化実行**: 「最適化」ボタンで自動配置を実行
5. **ロック**: 位置を固定したいタスクをロック

### キーボードショートカット

- **Delete**: 選択中のタスクを削除
- **クリック**: タスクの選択/選択解除

## テスト

このプロジェクトには包括的なテストスイートが含まれています：

```bash
# 全テスト実行
npm run test

# テストUI（ブラウザ）で実行
npm run test:ui
```

### テスト構成

- **コンポーネントテスト**: 各 UI コンポーネントの動作テスト
- **統合テスト**: コンテキスト間の連携テスト
- **ユーティリティテスト**: アルゴリズムと計算ロジックのテスト
- **E2E テスト**: ドラッグ&ドロップなどの操作フローテスト

## 開発時の注意点

### 型安全性

- 全てのコンポーネントと関数は TypeScript で厳格に型定義
- `types.ts` で共通の型定義を管理
- Props インターフェースは各コンポーネントファイル内で定義

### スタイリング規約

- CSS Modules は使用せず、個別の CSS ファイルで管理
- BEM 記法に準拠したクラス名（例: `.task-card__header`, `.task-card--selected`）
- レスポンシブデザインは CSS メディアクエリで実装

### 状態管理

- React Context を活用した状態管理
- `TaskContext`: 全体のタスク管理とタイムライン操作
- `TaskSidebarContext`: サイドバーでの編集状態管理
- `TaskStagingContext`: ステージングエリアでのドラッグ&ドロップ管理

### パフォーマンス最適化

- `useCallback` と `useMemo` を適切に活用
- ドラッグ&ドロップ時の不要な再レンダリングを防止
- タスク重複計算の最適化

## トラブルシューティング

### よくある問題

**Q: ドラッグ&ドロップが動作しない**
A: ブラウザの開発者ツールでコンソールエラーを確認してください。`draggedTaskId` の状態管理が正しく動作しているか確認してください。

**Q: タスクの時間が正しく表示されない**
A: `timeUtils.ts` の時間計算関数を確認してください。全て 15 分刻みで計算されているはずです。

**Q: 最適化アルゴリズムが期待通りに動作しない**
A: `taskOptimization.ts` のロジックとテストケースを確認してください。ロックされたタスクは固定位置として扱われます。

**Q: テストが失敗する**
A: 非同期処理や DOM 操作のテストでは `waitFor` や `findBy*` メソッドを使用してください。

### デバッグのコツ

- React Developer Tools の活用
- タスク状態の変化をコンソールログで追跡
- ドラッグ&ドロップイベントの詳細をブラウザ DevTools で確認

## ライセンス

このプロジェクトは MIT ライセンスの下で公開されています。

## 貢献

プルリクエストやイシューの報告を歓迎します。開発に参加する際は、以下の点にご注意ください：

1. テストカバレッジを維持する
2. TypeScript の型安全性を保つ
3. 日本語でのコメントとドキュメント作成
4. レスポンシブデザインの確認
